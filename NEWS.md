# Release Notes - ÈíüÈ¶ó (Zhongkui) 

- v0.0.3
- v0.0.2
- v0.0.1

## üöÄ v0.0.3 - Enhanced CLI & Output Control

### ‚ú® New Features
- **Real-time Output Redirection**: New `--redirect-stdio` option for `run-and-analyze` command
  - Enables real-time viewing of Bazel build output directly in terminal
  - Maintains log file creation for later analysis
  - Improved user experience for monitoring long builds
- **Build Output Optimization**: Enhanced Bazel command execution with optimization flags
  - `--curses=no`: Cleaner output without terminal control sequences
  - `--color=yes`: Colored output for better readability
  - `--noprogress_in_terminal_title`: Prevents terminal title pollution

### üîÑ Changed  
- **Dual Output Mode**: Build commands now support both real-time display and log file preservation
- **Improved User Messaging**: Better feedback about output modes and log file locations
- **Command Structure**: Optimization flags are properly positioned in Bazel command options

### üõ† Technical Details
- Enhanced `executeCommandWithLog()` function with stdio redirection capability
- Added proper stream piping for both stdout and stderr to current process
- Maintained backward compatibility with existing log-only behavior
- Correct parameter positioning in Bazel command construction

### üí° Usage Examples
```bash
# Real-time output with log file backup
zhongkui run-and-analyze --redirect-stdio -c "bazel build //app:*"

# Traditional log-only mode (default)
zhongkui run-and-analyze -c "bazel build //app:*"
```

**Impact**: Users can now monitor build progress in real-time while still maintaining comprehensive log files for analysis.

## üîß v0.0.2 - Bug Fixes & Improvements

### üêõ Fixed
- **Time Calculation Logic**: Fixed incorrect time attribution in package hotspot analysis
  - `actualTime` now correctly shows only direct actions time (actions executed directly in the package)
  - `transitiveTime` now correctly shows transitive actions time (actions caused by package changes but executed elsewhere)
  - Previously, `actualTime` incorrectly included both direct and transitive actions, while `transitiveTime` was always 0
- **Report Consistency**: Fixed inconsistency between `changedPackagesAnalysis` and `hotspots` time calculations
- **Analyzer Alignment**: Applied consistent time calculation logic across both `SimpleDependencyAnalyzer` and `DependencyAnalyzer`

### üîÑ Changed  
- **Time Attribution Semantics**: Clarified the meaning of time fields in reports:
  - `actualTime`: Time spent on actions directly in this package due to changes
  - `transitiveTime`: Time spent on actions caused by this package's changes but executed in other packages
  - This provides clearer insight into where build time is actually being spent

### üõ† Technical Details
- Updated `SimpleDependencyAnalyzer.calculatePackageStats()` with correct time separation logic
- Updated `DependencyAnalyzer.calculatePackageHotspots()` with proper field initialization
- Fixed `HotspotReporter.generateChangedPackagesAnalysis()` fallback calculations
- All analyzers now consistently populate `actualCompilationTime` and `transitiveCompilationTime` fields

**Impact**: Reports now accurately show the breakdown of build time, making it easier to identify optimization opportunities.

## üéâ Initial Release

We're excited to announce the first release of **ÈíüÈ¶ó (Zhongkui)** - a powerful local build performance analysis tool for Bazel monorepos.

## ‚ú® Key Features

### Core Analysis Capabilities
- **Bazel Profile Analysis**: Parse Chrome Tracing format JSON files generated by `bazel build --profile=profile.json`
- **Git Diff Integration**: Analyze file changes to identify affected Bazel packages
- **Dependency Correlation**: Advanced attribution logic that maps build time to responsible packages
- **Pure Local Operation**: Works entirely offline without requiring BEP infrastructure

### Three Analysis Modes

#### 1. Profile Analysis (`analyze`)
Analyze existing Bazel profile files with detailed timing data:
```bash
zhongkui analyze -p profile.json -c "bazel build //app:* --config=release"
```

#### 2. Run & Analyze (`run-and-analyze`) 
Execute Bazel commands with profiling and automatic analysis:
```bash
zhongkui run-and-analyze -c "bazel build //src:..." --keep-profile
```

#### 3. Impact Prediction (`predict-impact`)
Static analysis to predict affected packages before building:
```bash
zhongkui predict-impact -c "bazel build //app:*" --base-branch origin/main
```

### Advanced Attribution Logic
- **Direct Attribution**: Actions in changed packages receive full duration attribution
- **Transitive Tracking**: Actions in dependent packages tracked without double-counting
- **Shared Dependencies**: Split attribution when multiple packages contribute to an action
- **Pure Attribution**: Total attributed time equals actual build time

### Multi-Repository Support
- **External Repositories**: Full support for Bazel 6+ Bzlmod format (`@@repo~//package`)
- **Additional Repos**: Analyze changes across multiple sub-repositories
- **Scoped Analysis**: Target pattern scoping to avoid irrelevant dependency analysis

## üõ† Technical Highlights

### Architecture
- **Modular Design**: Clear separation between profile analysis, diff analysis, and dependency correlation
- **Bazel Query Integration**: Accurate target-to-package mapping using native Bazel queries
- **Performance Optimized**: Caching and incremental analysis for large monorepos

### Build System
- **Bazel + rules_js**: Modern build system with incremental compilation
- **TypeScript**: Full type safety with comprehensive type definitions
- **Node.js 20.6.0**: Latest LTS runtime managed by Bazel

### Output Formats
- **JSON Reports**: Machine-readable analysis results for data product integration
- **Markdown Reports**: Human-readable reports with actionable recommendations
- **Colorful CLI**: Enhanced terminal output with progress indicators

## üìä Report Generation

### Analysis Reports
- `report-{profileId}-{timestamp}.json` - Complete analysis data
- `report-{profileId}-{timestamp}.md` - Formatted recommendations

### Prediction Reports  
- `impact-prediction-{profileId}-{timestamp}.json` - Static impact analysis
- `impact-prediction-{profileId}-{timestamp}.md` - Pre-build planning guide

## üîß Installation & Usage

### Prerequisites
- Bazel 6.0+
- Node.js 20.6.0
- Git repository

### Quick Start
```bash
# Build the tool
bazel build //src:zhongkui

# Generate profile and analyze
bazel run //src:zhongkui -- run-and-analyze -c "bazel build //your-targets..."

# Predict impact before building
bazel run //src:zhongkui -- predict-impact -c "bazel build //your-targets..."
```

## üéØ Use Cases

- **Build Optimization**: Identify hotspots consuming the most build time
- **Change Impact Analysis**: Understand which packages are affected by code changes
- **Pre-build Planning**: Predict build impact before making changes
- **Performance Monitoring**: Track build performance over time across different branches

## üôè Acknowledgments

ÈíüÈ¶ó is designed for teams working with large-scale Bazel monorepos who need actionable insights into their build performance without complex infrastructure dependencies.

---

**Full Changelog**: Initial release

**Compatibility**: Bazel 6.0+, Node.js 20.6.0+
